<!DOCTYPE html>  <html> <head>   <title>main.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               main.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Livefyre StreamHub + Filepicker.io</h1>

<p>StreamHub hosts Collections of Content.
StreamHub-Backbone helps you render them nicely.
Filepicker.io is a great source of Content.
Now you can use them all together. Hooray!</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Load config, which tells RequireJS where dependencies are</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s1">&#39;./config&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Display the Collection of Content</h2>

<p>This is what the user will see</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>First, get the required dependencies</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">([</span>
    <span class="s1">&#39;fyre&#39;</span><span class="p">,</span>
    <span class="s1">&#39;streamhub-backbone&#39;</span><span class="p">,</span>
    <span class="s1">&#39;text!streamhub-backbone/templates/Content.html&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mustache&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jquery&#39;</span><span class="p">],</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">fyre</span><span class="p">,</span> <span class="nx">Hub</span><span class="p">,</span> <span class="nx">ContentHtml</span><span class="p">,</span> <span class="nx">Mustache</span><span class="p">,</span> <span class="nx">$</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Load a StreamHub SDK</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">fyre</span><span class="p">.</span><span class="nx">conv</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
        <span class="nx">network</span><span class="o">:</span> <span class="s2">&quot;labs-t402.fyre.co&quot;</span>
    <span class="p">},</span> <span class="p">[{</span><span class="nx">app</span><span class="o">:</span> <span class="s1">&#39;sdk&#39;</span><span class="p">}],</span> <span class="nx">loadApp</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This will be passed the instantiated SDK object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">loadApp</span> <span class="p">(</span><span class="nx">sdk</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hub</span><span class="p">({</span>
            <span class="nx">sdk</span><span class="o">:</span> <span class="nx">sdk</span><span class="p">,</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">siteId</span><span class="o">:</span> <span class="s2">&quot;303827&quot;</span><span class="p">,</span>
                <span class="nx">articleId</span><span class="o">:</span> <span class="s2">&quot;fp_demo_0&quot;</span>
            <span class="p">},</span>
            <span class="nx">contentViewOptions</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">template</span><span class="o">:</span> <span class="nx">filePickerTemplate</span>
            <span class="p">},</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;example-feed&quot;</span><span class="p">)</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Use the same Livefyre Auth Token for all uploads.
This is just a demo user.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">userToken</span> <span class="o">=</span> <span class="s1">&#39;eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJkb21haW4iOiAibGFicy10NDAyLmZ5cmUuY28iLCAiZXhwaXJlcyI6IDEzNjY0OTE0NjkuNjU0NjU4LCAidXNlcl9pZCI6ICJ1c2VyXzAifQ.MSGGgu67OrS2C2ENro5NR6YVF5f7wJeoKuR3IzNqHZ4&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The JS SDK must be told what token to use</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">_sdkCollection</span><span class="p">.</span><span class="nx">setUserToken</span><span class="p">(</span><span class="nx">userToken</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Rendering picked files</h3>

<p>StreamHub does not quite yet support attaching images
via API. It will soon, but until then, Filepicker links
will be submitted just as links, and this template will
parse them out and turn them into attached Media. Sneaky.</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Compile the default Content Mustache template.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">contentTemplate</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">ContentHtml</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>This is the custom template function. Template functions
take in Content JSON and output HTML</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">filePickerTemplate</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Look in the bodyHtml for links that contain filepicker</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">bodyHtml</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">bodyHtml</span><span class="p">,</span>
            <span class="nx">$html</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">bodyHtml</span><span class="p">),</span>
            <span class="nx">$anchors</span> <span class="o">=</span> <span class="nx">$html</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span>
            <span class="nx">$filePickerAnchors</span> <span class="o">=</span> <span class="nx">$anchors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;a[href*=&quot;filepicker&quot;]&#39;</span><span class="p">),</span>
            <span class="nx">attachments</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$filePickerAnchors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If there's filepicker links, add an attachment for each</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$filePickerAnchors</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Attachments are oEmbed JSON Objects</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">attachments</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                    <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;photo&#39;</span><span class="p">,</span>
                    <span class="nx">provider</span><span class="o">:</span> <span class="s1">&#39;filepicker&#39;</span><span class="p">,</span>
                    <span class="nx">url</span><span class="o">:</span> <span class="nx">element</span><span class="p">.</span><span class="nx">innerText</span>
                <span class="p">});</span>
            <span class="p">});</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">attachments</span> <span class="o">=</span> <span class="nx">attachments</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Remove the actual links from the bodyHtml
since they're now rich attachments</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$filePickerAnchors</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">bodyHtml</span> <span class="o">=</span> <span class="nx">outerHtml</span><span class="p">(</span><span class="nx">$html</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Change the display name to the heroic UploaderDude</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">data</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">=</span> <span class="s1">&#39;UploaderDude&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">contentTemplate</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Returns the full HTML representation of an $element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">outerHtml</span> <span class="p">(</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">clone</span><span class="p">()).</span><span class="nx">html</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>The Filepicking button</h2>

<p>When a user clicks the button, help them pick a file through
Filepicker.io. Then post it to the StreamHub Collection</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>First, load the dependencies</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">([</span>
    <span class="s1">&#39;filepicker&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jquery&#39;</span><span class="p">],</span>
<span class="kd">function</span> <span class="p">(</span><span class="nx">filepicker</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">postUrl</span> <span class="o">=</span> <span class="s1">&#39;http://quill.labs-t402.fyre.co/api/v3.0/collection/10667505/post/&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Filepicker.io needs to know what API Key to use</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">filepicker</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="s1">&#39;AYNlO8P2PT6qnCfo9eCw2z&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Bind a click handler to the upload button so that it
lets you pick a file when you click it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.upload-button&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="nx">pickFile</span><span class="p">(</span><span class="nx">postFile</span><span class="p">);</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>Use Filepicker.io to choose a file</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">pickFile</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filepicker</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Only allow images</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="p">{</span><span class="nx">mimetype</span><span class="o">:</span> <span class="s1">&#39;image/*&#39;</span><span class="p">},</span>
            <span class="kd">function</span> <span class="nx">filePickSuccess</span> <span class="p">(</span><span class="nx">fpFile</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Pass the <code>fpFile</code> to the provided <code>cb</code></p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">cb</span><span class="p">(</span><span class="nx">fpFile</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">errorPicking</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">errorPicking</span> <span class="p">(</span><span class="nx">fpError</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error picking&quot;</span><span class="p">,</span> <span class="nx">fpError</span><span class="p">);</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>Post the File into StreamHub</h3>

<p>Posted Content will come down from the Collection's stream</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">postFile</span> <span class="p">(</span><span class="nx">fpFile</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">fpFile</span> <span class="o">||</span> <span class="o">!</span> <span class="nx">fpFile</span><span class="p">.</span><span class="nx">url</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;There is no file to post&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Use the raw JS SDK to post Content to the Collection</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">_sdkCollection</span><span class="p">.</span><span class="nx">postContent</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The Content bodyHtml will just be a link
to the picked file. We'll parse it out on render</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">bodyHtml</span><span class="o">:</span> <span class="nx">fpFile</span><span class="p">.</span><span class="nx">url</span>
        <span class="p">},</span> <span class="nx">onPostSuccess</span><span class="p">,</span> <span class="nx">onPostError</span><span class="p">);</span>
        <span class="kd">function</span> <span class="nx">onPostSuccess</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Successful posting to StreamHub&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">function</span> <span class="nx">onPostError</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error posting to StreamHub&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;main loaded&#39;</span><span class="p">);</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 